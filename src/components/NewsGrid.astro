---
import { fetchApi } from "../lib/strapi";
import type {
    StrapiResponse,
    NoticiaAttributes,
    StrapiData,
} from "../interfaces/strapi";
import NoticiaCard from "./ui/NoticiaCard.astro";

interface Props {
    limit?: number;
}

const { limit = 6 } = Astro.props;

let noticias: StrapiData<NoticiaAttributes>[] = [];
let error = null;

try {
    const response = await fetchApi<
        StrapiResponse<StrapiData<NoticiaAttributes>[]>
    >({
        endpoint: "noticias",
        query: {
            sort: ["fecha:desc"],
            pagination: {
                limit: limit,
            },
            populate: {
                imagen_destacada: "*",
                etiquetas: "*",
            },
        },
    });
    noticias = response.data;
} catch (e) {
    console.error("Error cargando noticias:", e);
    error = e;
}
---

{
    error && (
        <div class="p-4 bg-red-50 text-red-600 rounded-lg text-center border border-red-200">
            <p class="font-semibold">No se pudieron cargar las noticias.</p>
            <p class="text-sm mt-1">Por favor, intenta m√°s tarde.</p>
        </div>
    )
}

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    {noticias.map((noticia) => <NoticiaCard noticia={noticia} />)}
</div>
